<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AitoType 主界面高保真原型</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#3B82F6',
              secondary: '#60A5FA',
              cta: '#F97316',
              basebg: '#F8FAFC',
              textmain: '#1E293B'
            },
            fontFamily: {
              sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif']
            },
            boxShadow: {
              panel: '0 12px 24px rgba(15, 23, 42, 0.08)',
              soft: '0 6px 16px rgba(15, 23, 42, 0.06)'
            }
          }
        }
      };
    </script>
    <style>
      body {
        background:
          radial-gradient(circle at 7% 12%, rgba(96, 165, 250, 0.2), transparent 30%),
          radial-gradient(circle at 90% 85%, rgba(59, 130, 246, 0.14), transparent 28%),
          #f8fafc;
      }

      .panel-transition {
        transition: transform 200ms ease, opacity 200ms ease, box-shadow 200ms ease;
      }

      .panel-transition:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.1);
      }

      .focus-visible-ring:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.35);
      }

      .pulse-ring {
        animation: ring 1.4s ease-out infinite;
      }

      @keyframes ring {
        0% {
          transform: scale(1);
          opacity: 0.9;
        }
        100% {
          transform: scale(1.7);
          opacity: 0;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .panel-transition,
        .panel-transition:hover,
        .pulse-ring,
        .btn-anim,
        .progress-anim {
          transition: none !important;
          animation: none !important;
          transform: none !important;
        }
      }
    </style>
  </head>
  <body class="min-h-screen font-sans text-textmain antialiased">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:z-50 focus:rounded-md focus:bg-white focus:px-3 focus:py-2 focus:text-sm focus:font-medium focus:shadow-soft">跳到主要内容</a>

    <div class="mx-auto w-full max-w-5xl px-4 py-8 sm:px-6 lg:px-8">
      <header class="panel-transition mb-6 rounded-2xl border border-slate-200 bg-white/95 p-6 shadow-panel">
        <div class="flex flex-col gap-5 md:flex-row md:items-start md:justify-between">
          <div>
            <p class="mb-2 inline-flex items-center rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-primary">AitoType · 主界面</p>
            <h1 class="text-2xl font-extrabold tracking-tight text-slate-900 md:text-3xl">一键语音输入</h1>
            <p class="mt-2 max-w-2xl text-sm leading-6 text-slate-700">按下录音按钮或使用全局快捷键（⌘+⇧+Space），完成后将自动输入到当前激活应用。</p>
          </div>
          <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm">
            <p class="font-semibold text-slate-900">当前配置</p>
            <p class="mt-2 text-slate-700">Provider：<span id="active-provider" class="font-semibold">Groq</span></p>
            <p class="text-slate-700">Model：<span class="font-semibold">whisper-large-v3-turbo</span></p>
            <a href="./aitotype_settings_hifi_prototype.html" class="focus-visible-ring mt-3 inline-flex rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-800 transition duration-200 hover:border-slate-400 hover:bg-slate-100">打开设置页</a>
          </div>
        </div>
      </header>

      <main id="main-content" class="grid gap-5 lg:grid-cols-[1.35fr_1fr]">
        <section class="panel-transition rounded-2xl border border-slate-200 bg-white p-6 shadow-soft" aria-labelledby="capture-title">
          <h2 id="capture-title" class="text-lg font-bold text-slate-900">录音主控</h2>
          <p class="mt-1 text-sm text-slate-700">状态流：idle -> recording -> transcribing -> success/error</p>

          <div class="mt-6 flex flex-col items-center justify-center rounded-2xl border border-slate-200 bg-slate-50 px-4 py-8">
            <div class="relative flex h-32 w-32 items-center justify-center">
              <span id="ring" class="pulse-ring absolute hidden h-20 w-20 rounded-full bg-red-200"></span>
              <button id="record-btn" type="button" aria-live="polite" class="focus-visible-ring btn-anim relative z-10 h-20 w-20 cursor-pointer rounded-full bg-primary text-white shadow-soft transition duration-200 hover:bg-blue-600">
                <span id="record-btn-label" class="text-sm font-bold">开始</span>
              </button>
            </div>

            <p id="main-state" class="mt-4 text-base font-semibold text-slate-900">待机中</p>
            <p id="main-desc" class="mt-1 text-sm text-slate-700">点击按钮开始录音，或按快捷键触发。</p>

            <div class="mt-5 w-full max-w-md">
              <div class="mb-2 flex items-center justify-between text-xs text-slate-600">
                <span>音频能量</span>
                <span id="energy-value">0%</span>
              </div>
              <div class="h-2 rounded-full bg-slate-200">
                <div id="energy-bar" class="progress-anim h-2 w-0 rounded-full bg-primary transition-all duration-200"></div>
              </div>
            </div>
          </div>

          <div class="mt-4 flex flex-wrap gap-2">
            <button id="simulate-error" type="button" class="focus-visible-ring btn-anim cursor-pointer rounded-xl border border-red-300 bg-red-50 px-3 py-2 text-xs font-semibold text-red-700 transition duration-200 hover:bg-red-100">模拟失败</button>
            <button id="reset-main" type="button" class="focus-visible-ring btn-anim cursor-pointer rounded-xl border border-slate-300 bg-white px-3 py-2 text-xs font-semibold text-slate-800 transition duration-200 hover:border-slate-400 hover:bg-slate-100">重置状态</button>
            <button id="copy-result" type="button" class="focus-visible-ring btn-anim cursor-pointer rounded-xl border border-slate-300 bg-white px-3 py-2 text-xs font-semibold text-slate-800 transition duration-200 hover:border-slate-400 hover:bg-slate-100">复制转写</button>
          </div>
        </section>

        <aside class="space-y-5">
          <section class="panel-transition rounded-2xl border border-slate-200 bg-white p-5 shadow-soft" aria-labelledby="permission-title">
            <h3 id="permission-title" class="text-base font-bold text-slate-900">权限状态</h3>
            <ul class="mt-3 space-y-2 text-sm">
              <li class="flex items-center justify-between rounded-lg bg-emerald-50 px-3 py-2">
                <span class="font-medium text-slate-800">麦克风</span>
                <span class="rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-semibold text-emerald-700">已授权</span>
              </li>
              <li class="flex items-center justify-between rounded-lg bg-amber-50 px-3 py-2">
                <span class="font-medium text-slate-800">辅助功能</span>
                <span class="rounded-full bg-amber-100 px-2 py-0.5 text-xs font-semibold text-amber-700">待确认</span>
              </li>
            </ul>
          </section>

          <section class="panel-transition rounded-2xl border border-slate-200 bg-white p-5 shadow-soft" aria-labelledby="result-title">
            <h3 id="result-title" class="text-base font-bold text-slate-900">最近转写结果</h3>
            <div id="result-box" class="mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm leading-6 text-slate-800" role="status" aria-live="polite">
              还没有新的转写结果。
            </div>
          </section>

          <section class="panel-transition rounded-2xl border border-slate-200 bg-white p-5 shadow-soft" aria-labelledby="history-title">
            <h3 id="history-title" class="text-base font-bold text-slate-900">会话历史（示例）</h3>
            <ol class="mt-3 space-y-2 text-sm text-slate-700">
              <li class="rounded-lg border border-slate-200 bg-white px-3 py-2">09:12 会议纪要：今日发布节奏需要前置沟通。</li>
              <li class="rounded-lg border border-slate-200 bg-white px-3 py-2">08:55 TODO：完善 Provider 切换与异常提示。</li>
              <li class="rounded-lg border border-slate-200 bg-white px-3 py-2">08:41 草稿：支持中文标点自动补全。</li>
            </ol>
          </section>
        </aside>
      </main>
    </div>

    <script>
      const recordBtn = document.getElementById('record-btn');
      const recordBtnLabel = document.getElementById('record-btn-label');
      const ring = document.getElementById('ring');
      const mainState = document.getElementById('main-state');
      const mainDesc = document.getElementById('main-desc');
      const energyBar = document.getElementById('energy-bar');
      const energyValue = document.getElementById('energy-value');
      const resultBox = document.getElementById('result-box');
      const simulateErrorBtn = document.getElementById('simulate-error');
      const resetMainBtn = document.getElementById('reset-main');
      const copyResultBtn = document.getElementById('copy-result');
      const activeProvider = document.getElementById('active-provider');

      let uiState = 'idle';
      let energyTimer = null;

      function setState(next) {
        uiState = next;

        if (next === 'idle') {
          ring.classList.add('hidden');
          recordBtn.className = 'focus-visible-ring btn-anim relative z-10 h-20 w-20 cursor-pointer rounded-full bg-primary text-white shadow-soft transition duration-200 hover:bg-blue-600';
          recordBtnLabel.textContent = '开始';
          mainState.textContent = '待机中';
          mainDesc.textContent = '点击按钮开始录音，或按快捷键触发。';
          energyBar.style.width = '0%';
          energyValue.textContent = '0%';
          stopEnergy();
          return;
        }

        if (next === 'recording') {
          ring.classList.remove('hidden');
          recordBtn.className = 'focus-visible-ring btn-anim relative z-10 h-20 w-20 cursor-pointer rounded-full bg-red-500 text-white shadow-soft transition duration-200 hover:bg-red-600';
          recordBtnLabel.textContent = '停止';
          mainState.textContent = '录音中';
          mainDesc.textContent = '请正常说话，松开后将自动转写并输入。';
          startEnergy();
          return;
        }

        if (next === 'transcribing') {
          ring.classList.add('hidden');
          recordBtn.className = 'focus-visible-ring btn-anim relative z-10 h-20 w-20 cursor-not-allowed rounded-full bg-slate-400 text-white shadow-soft';
          recordBtnLabel.textContent = '处理中';
          mainState.textContent = '转写中';
          mainDesc.textContent = '音频已上传，正在进行语音识别...';
          stopEnergy();
          energyBar.style.width = '100%';
          energyValue.textContent = '100%';
          return;
        }

        if (next === 'success') {
          recordBtn.className = 'focus-visible-ring btn-anim relative z-10 h-20 w-20 cursor-pointer rounded-full bg-emerald-500 text-white shadow-soft transition duration-200 hover:bg-emerald-600';
          recordBtnLabel.textContent = '完成';
          mainState.textContent = '转写成功';
          mainDesc.textContent = '结果已准备好，可复制或直接输入到目标应用。';
          resultBox.textContent = '今天下午 3 点前把最新构建结果同步给测试团队，优先验证语音输入主流程。';
          activeProvider.textContent = 'Groq';
          return;
        }

        recordBtn.className = 'focus-visible-ring btn-anim relative z-10 h-20 w-20 cursor-pointer rounded-full bg-red-600 text-white shadow-soft transition duration-200 hover:bg-red-700';
        recordBtnLabel.textContent = '重试';
        mainState.textContent = '转写失败';
        mainDesc.textContent = '请检查网络、API Key 或切换 Provider 后重试。';
        resultBox.textContent = '错误：请求超时。建议检查网络连接或更换模型。';
        activeProvider.textContent = 'Custom';
      }

      function startEnergy() {
        stopEnergy();
        energyTimer = window.setInterval(() => {
          const value = 20 + Math.floor(Math.random() * 70);
          energyBar.style.width = value + '%';
          energyValue.textContent = value + '%';
        }, 220);
      }

      function stopEnergy() {
        if (energyTimer) {
          window.clearInterval(energyTimer);
          energyTimer = null;
        }
      }

      recordBtn.addEventListener('click', () => {
        if (uiState === 'idle' || uiState === 'success' || uiState === 'error') {
          setState('recording');
          return;
        }

        if (uiState === 'recording') {
          setState('transcribing');
          window.setTimeout(() => setState('success'), 1300);
        }
      });

      simulateErrorBtn.addEventListener('click', () => {
        stopEnergy();
        setState('transcribing');
        window.setTimeout(() => setState('error'), 1000);
      });

      resetMainBtn.addEventListener('click', () => {
        resultBox.textContent = '还没有新的转写结果。';
        setState('idle');
      });

      copyResultBtn.addEventListener('click', async () => {
        const text = resultBox.textContent.trim();
        if (!text || text === '还没有新的转写结果。') {
          mainDesc.textContent = '暂无可复制内容，请先完成一次转写。';
          return;
        }

        try {
          await navigator.clipboard.writeText(text);
          mainDesc.textContent = '已复制转写内容到剪贴板（原型行为）。';
        } catch (error) {
          mainDesc.textContent = '复制失败：浏览器未授予剪贴板权限。';
        }
      });

      setState('idle');
    </script>
  </body>
</html>
